# SVIP 使用指南

## 一、系统定位

SVIP 是一个**慢变量投资池系统**，不是：
- ❌ 选股推荐系统
- ❌ 择时交易系统
- ❌ 收益预测系统

SVIP 是：
- ✅ 结构质量筛选器
- ✅ 估值安全垫过滤器
- ✅ 相位识别系统
- ✅ 组合约束引擎

## 二、典型工作流程

### 年度工作（每年1次）

#### 1. 更新慢变量清单

编辑 `data/slow_variables.yaml`，写出未来10年确定性最高的3-5个慢变量。

规则：
- 只允许3-5个
- 不允许"宏观情绪类变量"
- 必须符合慢变量三条判据（见理论文档）

示例：
```yaml
slow_variables:
  - name: "AI算力密度提升"
    time_horizon: "15年"
    certainty: "高"
    theme: "AI/算力密度"
```

#### 2. 结构筛选（M1）

对全市场股票运行 SVI 评分：
- 10年ROIC中位数 ≥ 15%
- FCF/净利润 ≥ 0.8
- 毛利率波动 < ±5%
- 负债不过高

选出 10-20 家进入候选池。

### 半年工作（每年2次）

#### 3. 估值过滤（M2）

对候选池运行 A1 估值评估：
- FCF Yield ≥ 3%
- QPEG ≤ 1.8
- 不处于历史估值80%分位以上

不满足 → 进入观察池，等待价格回调。

### 季度工作（每年4次）

#### 4. 相位判断（M3）

检查慢变量代理指标是否仍在扩张：
- AI算力：GPU出货量、CAPEX
- 医疗：医疗支出/GDP、慢病诊断率
- 金融：非现金支付比例、跨境交易量

若行业层指标明显下行 → 减仓。

#### 5. 生成报告

```bash
python run_svip.py --stocks data/my_stocks.yaml --market US
```

查看 `reports/` 目录下的 Markdown 报告。

### 月度观察（每月1次）

#### 6. 宏观过滤（M4）

更新 `data/macro_inputs.yaml`：
- 实际利率
- 流动性（M2、信贷增长）
- 盈利方向

若宏观逆风 → 系统自动降低仓位上限。

## 三、数据准备

### 方式1：手动准备 YAML

适合小规模测试（5-20只股票）。

参考 `data/sample_stocks.yaml` 格式，填写：
- 财务数据（10年ROIC、FCF、毛利率等）
- 估值数据（FCF Yield、PE、增长率等）
- 主题归属

### 方式2：从数据库读取

适合大规模筛选（全市场扫描）。

可以从 `../database/china_a_stocks.db` 或 `us_stocks_financial_data.db` 读取财务数据。

需要自己编写数据读取脚本，参考 `run_svip.py` 中的 `build_stocks_from_yaml` 函数。

### 方式3：API 获取

使用 yfinance、akshare 等库实时获取数据。

需要安装可选依赖：
```bash
pip install -e ".[auto]"
```

## 四、报告解读

### 系统状态概览

```
总股票仓位: 72.5%
现金: 27.5%
核心池仓位: 68.0%
观察池仓位: 4.5%
仓位上限: 76.5%
宏观因子: 0.90
尾部风险因子: 1.00
```

**解读**：
- 当前宏观逆风（因子0.90），系统自动压缩仓位
- 核心池占主导（68%），符合慢变量投资逻辑
- 观察池较小（4.5%），说明大部分标的估值合理

### 核心池标的

```
| 代码 | 名称 | SVI | 估值 | 相位 | 目标权重 | 行动 |
|------|------|-----|------|------|---------|------|
| MSFT | Microsoft | 85 | 🟢 A | 🚀 | 8.0% | add |
| V    | Visa      | 88 | 🟢 A | ➡️ | 7.5% | hold |
| UNH  | UnitedHealth | 78 | 🟢 A | ➡️ | 6.2% | hold |
```

**解读**：
- MSFT：高质量（SVI=85）+ 好价格（Tier A）+ 加速期（🚀）→ 加仓窗口
- V：高质量 + 好价格 + 稳态期 → 持有
- UNH：质量略低但仍在核心池，估值安全 → 持有

### 主题暴露

```
| 主题 | 权重 |
|------|------|
| AI/算力密度 | 28.5% |
| 金融制度/支付清算 | 22.0% |
| 老龄化/医疗支付 | 18.0% |
```

**解读**：
- AI主题接近上限（30%），不能再加仓
- 三大主题分散，避免单一慢变量押注

### 宏观慢变量状态

```
| 指标 | 评分 | 状态 |
|------|------|------|
| 利率结构 | +1 | 顺风 |
| 流动性 | -1 | 逆风 |
| 盈利周期 | 0 | 中性 |

综合评分: 0 ➡️ neutral
MacroRiskFactor: 0.90
```

**解读**：
- 利率结构友好，但流动性收缩
- 综合中性偏逆风，系统降低仓位上限10%

### 轮动信号

```
| 主题 | 平均加速度 | Z-Score | 权重调整 |
|------|-----------|---------|---------|
| AI/算力密度 | 68.5 | +1.25 | +10% |
| 老龄化/医疗支付 | 52.0 | +0.15 | 不变 |
| 金融制度/支付清算 | 48.0 | -0.35 | 不变 |
```

**解读**：
- AI主题加速度最强（Z=+1.25），建议增加10%权重
- 但需注意主题上限（30%），不能无限加仓

## 五、常见问题

### Q1: 为什么我的高质量股票被分到观察池？

A: 可能原因：
1. 估值 Tier = B 或 C（太贵）
2. 相位处于衰减期（慢变量代理指标下行）
3. 红旗触发（估值分位过高、增长预期过度集中等）

**行动**：等待价格回调或相位改善，不要追高。

### Q2: 为什么系统建议减仓我的持仓股？

A: 可能原因：
1. 相位从加速期→稳态期→衰减期
2. 估值从 A→B→C 降级
3. ROIC 连续下降
4. 慢变量方向改变

**行动**：先减50%，观察两季度，若未改善则清仓。

### Q3: 为什么现金比例这么高（30%）？

A: 可能原因：
1. ValuationTier=A 的标的数量 < 6（机会太少）
2. 全市场普遍估值脆弱（Tier C 占比 > 60%）
3. 宏观强逆风 + 尾部风险紧张

**行动**：耐心等待，慢变量系统不追热点。现金是"等待慢变量给窗口"。

### Q4: 系统为什么不推荐热门成长股？

A: SVIP 不是成长股系统。

热门成长股往往：
- ROIC 不稳定（未通过硬筛选）
- FCF 转化率低（烧钱）
- 估值极高（QPEG > 1.8）
- 慢变量绑定度低（快变量驱动）

**SVIP 只选择"慢变量对齐的结构稳定企业"**。

### Q5: 可以修改配置参数吗？

A: 不建议。

`config/settings.py` 中的所有阈值、权重都是基于理论体系设计的。随意修改会破坏系统逻辑。

如果一定要调整，建议：
1. 先运行3-6个月，观察系统行为
2. 记录每次想修改的冲动
3. 季度末统一评估是否真的需要调整

**慢变量系统的核心是"不因短期波动改变规则"**。

## 六、进阶使用

### 自定义慢变量主题

编辑 `data/theme_buckets.yaml`，添加新主题：

```yaml
theme_buckets:
  "你的主题":
    description: "主题描述"
    value_capture_nodes:
      - "价值捕获节点1"
      - "价值捕获节点2"
    typical_stocks:
      - {symbol: "XXX", name: "公司名"}
```

### 跨市场运行

```bash
# 美股
python run_svip.py --market US

# 港股（更严格的阈值）
python run_svip.py --market HK

# A股（相位权重 > 估值权重）
python run_svip.py --market CN
```

### 批量回测

编写脚本循环调用 `generate_report()`，记录每季度的组合配置，计算历史收益。

注意：
- 必须使用历史数据（避免未来函数）
- 财报发布滞后1个季度
- 包含交易成本（0.3%-0.5%）

## 七、与 SPUD-INVEST 联合使用

推荐工作流程：

1. **SVIP 选股** → 输出核心池（10-20只）
2. **SPUD-INVEST 定仓位** → 根据 SMI/MTI 确定总仓位上限
3. **SVIP 权重分配** → 在仓位上限内分配权重
4. **季度调仓** → 同时检查 SVIP 相位 + SPUD 稳定裕度

两者互补：
- SPUD 回答"现在能不能加仓"
- SVIP 回答"应该加仓哪些股票"

---

*SVIP v1.0 使用指南 — 2026年2月28日*
