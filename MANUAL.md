# SVIP v1.0 系统操作手册

> **慢变量投资池系统 (Slow Variable Investment Pool)**  
> 完整使用说明与操作指南  
> 版本：v1.0 | 日期：2026年2月28日

---

## 📖 目录

- [第一部分：系统简介](#第一部分系统简介)
- [第二部分：快速上手](#第二部分快速上手)
- [第三部分：核心概念](#第三部分核心概念)
- [第四部分：日常操作](#第四部分日常操作)
- [第五部分：报告解读](#第五部分报告解读)
- [第六部分：调仓决策](#第六部分调仓决策)
- [第七部分：常见问题](#第七部分常见问题)
- [第八部分：进阶使用](#第八部分进阶使用)

---

## 第一部分：系统简介

### 1.1 SVIP 是什么？

SVIP (Slow Variable Investment Pool) 是一个基于**慢变量存在论投资学**的股票筛选与组合管理系统。

**核心定位**：
- 不预测价格涨跌
- 不追逐市场热点
- 不做短期交易

**核心功能**：
- 识别与慢变量对齐的高质量企业
- 评估估值安全垫
- 判断慢变量相位（加速/稳态/衰减）
- 构建约束下的最优组合

### 1.2 核心理念

> **投资不是预测未来，而是在慢变量构成的存在地形中，寻找稳定结构并与之共振。**

**三条公理**：
1. 慢变量役使快变量
2. 存在优先于价格
3. 结构稳定性决定价值

### 1.3 适用人群

✅ **适合**：
- 长期价值投资者（持有周期 ≥ 1年）
- 认同"慢变量"理念的投资者
- 愿意承受短期波动的投资者
- 机构投资者、家族办公室

❌ **不适合**：
- 短期交易者（持有周期 < 3个月）
- 追求高换手率的投资者
- 纯技术分析交易者
- 希望"预测涨跌"的投资者


---

## 第二部分：快速上手

### 2.1 系统安装

#### 步骤1：进入项目目录

```bash
cd project/svip
```

#### 步骤2：安装依赖

```bash
# 基础安装
pip install -e .

# 完整安装（包含自动数据获取）
pip install -e ".[all]"
```

#### 步骤3：验证安装

```bash
python verify_setup.py
```

预期输出：
```
============================================================
  SVIP v1.0 安装验证
============================================================
🔍 检查模块导入...
   ✅ 所有模块导入成功
📁 检查数据文件...
   ✅ data/slow_variables.yaml
   ✅ data/theme_buckets.yaml
   ✅ data/sample_stocks.yaml
   ✅ data/macro_inputs.yaml
⚙️  检查配置...
   ✅ SVI 核心池阈值: 75.0
   ✅ 估值 FCF Yield 下限: 3.0%
🧪 运行功能测试...
   ✅ SVI 计算: 66.7 [watch]
   ✅ 估值评估: Tier B, QPEG=1.40
============================================================
  验证结果
============================================================
  模块导入         ✅ 通过
  数据文件         ✅ 通过
  配置检查         ✅ 通过
  功能测试         ✅ 通过
🎉 系统验证通过！
```

### 2.2 第一次运行

使用示例数据运行系统：

```bash
python run_svip.py
```

系统会：
1. 加载 6 只示例股票
2. 计算 SVI 评分
3. 评估估值安全垫
4. 构建组合
5. 生成报告（保存在 `reports/` 目录）

### 2.3 查看报告

```bash
# Windows
start reports\SVIP_US_报告_*.md

# Mac/Linux
open reports/SVIP_US_报告_*.md
```

报告包含：
- 系统状态概览
- 核心池/观察池标的
- 主题暴露分析
- 宏观与风险状态
- 轮动信号


---

## 第三部分：核心概念

### 3.1 SVI 慢变量指数

**定义**：衡量企业利润与慢变量绑定程度的综合评分（0-100分）。

**评分维度**（7个）：
1. 10年ROIC中位数（20%）
2. FCF转化率（15%）
3. 毛利稳定性（15%）
4. 行业集中度（15%）
5. 网络/牌照壁垒（15%）
6. 需求刚性（10%）
7. 替代风险（10%，反向）

**分级**：
- **≥75 分** → Core 核心池（可持有）
- **60-75 分** → Watch 观察池（等待机会）
- **<60 分** → Block 禁入池（不碰）

**硬筛选**（必须全部满足）：
- 10年ROIC中位数 ≥ 15%
- FCF/净利润 ≥ 0.8
- 毛利率波动 < ±5%
- 资产负债率 ≤ 1.5

### 3.2 A1 估值安全垫

**目标**：避免追高，确保有安全边际。

**两条核心规则**：
1. **FCF Yield 底线** ≥ 3%
2. **QPEG** (Quality-Adjusted PEG) ≤ 1.8

**QPEG 公式**：
```
QPEG = (PE / g) / (1 + SVI/100)
```
高质量企业（SVI高）可以"更贵一点"。

**三个红旗**（任一触发降级）：
- 🚩 估值分位 > 80%（拥挤）
- 🚩 增长预期集中度 > 60%（难兑现）
- 🚩 再投资回报连续2年下降（慢变量可能变伪）

**估值等级**：
- **Tier A** 🟢 — 好公司+好价格 → 可入核心池
- **Tier B** 🟡 — 好公司+合理/略贵 → 观察/小仓
- **Tier C** 🔴 — 好公司+极贵/脆弱 → 限仓/剔除

### 3.3 A2 慢变量加速检测

**目标**：判断慢变量是否正在释放能量。

**方法**：检测慢变量代理指标的"二阶导"（加速度）。

**代理指标示例**：
- AI算力：GPU出货量增速、$/FLOP下降速度
- 老龄化：医疗支出/GDP、慢病诊断率
- 金融制度：非现金支付比例、跨境交易量

**相位判定**：
- **加速期** 🚀 — AccelerationScore ≥ 60 → 加仓窗口
- **稳态期** ➡️ — 30 ≤ Score < 60 → 持有
- **衰减期** 📉 — Score < 30 → 减仓

### 3.4 A3 组合权重引擎

**权重公式**：
```
W_raw = Q × V × P
```
- Q = 质量因子（SVI → [0,1]）
- V = 估值因子（Tier A=1.0, B=0.6, C=0.2）
- P = 相位因子（加速=1.2, 稳态=1.0, 衰减=0.5）

**约束投影**（按顺序执行）：
1. 单票上限 8%
2. 单慢变量主题上限 30%
3. 单行业上限 25%
4. 核心池总仓位 60%-85%
5. 现金下限 10%

### 3.5 A4 宏观慢变量过滤器

**目标**：判断资金地形是否允许慢变量释放能量。

**三个宏观慢变量**：
1. 利率结构（10Y-2Y利差、实际利率、信用利差）
2. 流动性（M2同比、金融条件指数、信贷增长）
3. 盈利周期（标普500盈利同比、ISM新订单）

**评分**：每个变量 +1（顺风）/ 0（中性）/ -1（逆风）

**MacroRiskFactor**：
- 总分 +3 → 1.10（强顺风）
- 总分 0 → 0.90（中性）
- 总分 -3 → 0.75（强逆风）

**作用**：修正组合总仓位上限。

### 3.6 A7 极端风险模块

**三类极端风险**：
1. **流动性型** — VIX > 35、信用利差急剧扩大
2. **制度型** — 监管突变、牌照失效
3. **技术范式型** — 新技术彻底替代旧结构

**TailRiskFactor**：
- Normal 🟢 → 1.0
- Alert 🟡 → 0.9
- Tense 🟠 → 0.8
- Crisis 🔴 → 0.6

**危机状态约束**：
- 只保留 SVI ≥ 85 标的
- 单票上限降至 5%
- 现金 ≥ 40%

### 3.7 A8 慢变量主题轮动

**目标**：在慢变量桶之间做"结构再分配"。

**方法**：计算每个主题桶的平均加速度，做 Z-score 标准化。

**轮动规则**：
- Z ≥ +1.0 → 权重 +10%
- +0.5 ≤ Z < +1.0 → 权重 +5%
- -0.5 < Z < +0.5 → 不变
- -1.0 ≤ Z ≤ -0.5 → 权重 -5%
- Z < -1.0 → 权重 -10%

**频率**：每季度一次。


---

## 第四部分：日常操作

### 4.1 年度工作（每年1次）

#### 任务1：更新慢变量清单

**时间**：每年1月

**操作**：编辑 `data/slow_variables.yaml`

**步骤**：
1. 回顾过去一年的慢变量变化
2. 写出未来10年确定性最高的3-5个慢变量
3. 更新代理指标

**规则**：
- 只允许3-5个慢变量
- 不允许"宏观情绪类变量"
- 必须符合慢变量三条判据

**示例**：
```yaml
slow_variables:
  - name: "AI算力密度提升"
    time_horizon: "15年"
    certainty: "高"
    theme: "AI/算力密度"
    proxy_indicators:
      - "GPU出货量增速"
      - "$/FLOP下降速度"
      - "超大规模CAPEX"
```

#### 任务2：结构筛选（M1）

**时间**：每年1月

**操作**：对全市场股票运行 SVI 评分

**步骤**：
1. 准备财务数据（10年ROIC、FCF、毛利率等）
2. 运行 SVI 计算
3. 筛选出 SVI ≥ 60 的标的
4. 选出 10-20 家进入候选池

**命令**：
```bash
python run_svip.py --stocks data/my_stocks.yaml
```

### 4.2 半年工作（每年2次）

#### 任务3：估值过滤（M2）

**时间**：每年1月、7月

**操作**：对候选池运行 A1 估值评估

**步骤**：
1. 更新估值数据（FCF Yield、PE、增长率）
2. 运行估值评估
3. 将 Tier C 标的移入观察池

**判断标准**：
- FCF Yield ≥ 3%
- QPEG ≤ 1.8
- 不处于历史估值80%分位以上

**行动**：
- Tier A → 可入核心池
- Tier B → 观察池，等待价格回调
- Tier C → 禁入池或退出

### 4.3 季度工作（每年4次）

#### 任务4：相位判断（M3）

**时间**：每季度末（3月、6月、9月、12月）

**操作**：检查慢变量代理指标

**步骤**：
1. 更新代理指标时间序列
2. 计算加速度（二阶导）
3. 判断相位状态

**示例检查**：
- AI算力：GPU出货量是否仍在增长？
- 医疗：医疗支出/GDP是否仍在上升？
- 金融：非现金支付比例是否仍在扩张？

**行动**：
- 加速期 → 可加仓
- 稳态期 → 持有
- 衰减期 → 减仓50%，观察两季度

#### 任务5：生成报告

**操作**：
```bash
python run_svip.py --stocks data/my_stocks.yaml --market US
```

**输出**：
- 控制台摘要
- Markdown 完整报告（`reports/` 目录）

**检查内容**：
- 核心池标的是否有变化
- 估值等级是否降级
- 相位是否转变
- 主题暴露是否超限
- 是否有违规警告

### 4.4 月度观察（每月1次）

#### 任务6：宏观过滤（M4）

**时间**：每月初

**操作**：更新 `data/macro_inputs.yaml`

**数据来源**：
- FRED（美国经济数据）
- Wind/同花顺（中国数据）
- 手动填写

**关键指标**：
```yaml
macro:
  yield_spread_10y2y: 0.35    # 10Y-2Y利差
  real_yield: 1.8             # 实际利率
  credit_spread: 3.2          # 信用利差
  m2_yoy: 0.04               # M2同比
  earnings_yoy: 0.08          # 盈利同比
  ism_new_orders: 53.5        # ISM新订单
```

**行动**：
- 宏观顺风 → 系统自动提高仓位上限
- 宏观逆风 → 系统自动降低仓位上限
- 无需手动调整


---

## 第五部分：报告解读

### 5.1 系统状态概览

**示例**：
```
| 指标 | 值 |
|------|-----|
| 总股票仓位 | 72.5% |
| 现金 | 27.5% |
| 核心池仓位 | 68.0% |
| 观察池仓位 | 4.5% |
| 仓位上限 | 76.5% |
| 宏观因子 | 0.90 |
| 尾部风险因子 | 1.00 |
```

**解读要点**：

1. **总股票仓位 vs 仓位上限**
   - 接近上限 → 系统认为当前是较好配置时机
   - 远低于上限 → 估值普遍偏高或机会不足

2. **现金比例**
   - 10-20% → 正常水平
   - 20-30% → 机会较少，耐心等待
   - >30% → 全市场估值脆弱或宏观强逆风

3. **核心池 vs 观察池**
   - 核心池占主导（>60%）→ 符合慢变量投资逻辑
   - 观察池过大（>20%）→ 估值普遍偏高

4. **宏观因子**
   - >1.0 → 顺风，系统提高仓位上限
   - 0.9-1.0 → 中性
   - <0.9 → 逆风，系统降低仓位上限

5. **尾部风险因子**
   - 1.0 → 正常
   - 0.8-0.9 → 警戒/紧张
   - <0.8 → 危机，大幅压缩仓位

### 5.2 核心池标的

**示例**：
```
| 代码 | 名称 | SVI | 估值 | 相位 | 目标权重 | 行动 |
|------|------|-----|------|------|---------|------|
| MSFT | Microsoft | 85 | 🟢 A | 🚀 | 8.0% | add |
| V    | Visa      | 88 | 🟢 A | ➡️ | 7.5% | hold |
| UNH  | UnitedHealth | 78 | 🟡 B | ➡️ | 6.2% | hold |
| NVDA | NVIDIA    | 81 | 🔴 C | 🚀 | 0.0% | hold |
```

**解读要点**：

1. **MSFT**：
   - SVI 85（高质量）
   - 估值 Tier A（好价格）
   - 相位加速期（🚀）
   - **结论**：加仓窗口，建议增持

2. **V**：
   - SVI 88（极高质量）
   - 估值 Tier A
   - 相位稳态期（➡️）
   - **结论**：持有，不急于加仓

3. **UNH**：
   - SVI 78（质量略低但仍在核心池）
   - 估值 Tier B（略贵）
   - 相位稳态期
   - **结论**：持有，等待估值改善或相位加速

4. **NVDA**：
   - SVI 81（高质量）
   - 估值 Tier C（太贵）
   - 相位加速期
   - **结论**：虽然相位好，但估值脆弱，不入核心池

### 5.3 主题暴露

**示例**：
```
| 主题 | 权重 |
|------|------|
| AI/算力密度 | 28.5% |
| 金融制度/支付清算 | 22.0% |
| 老龄化/医疗支付 | 18.0% |
| 品牌/代际消费 | 8.0% |
```

**解读要点**：

1. **AI主题 28.5%**
   - 接近上限（30%）
   - 不能再加仓AI相关标的
   - 需要等待其他主题机会

2. **主题分散**
   - 三大主题占比均衡
   - 避免单一慢变量押注
   - 符合风险分散原则

3. **行动建议**：
   - 若AI主题继续加速，考虑轮动到其他主题
   - 若某主题长期低配，检查是否有遗漏机会

### 5.4 宏观慢变量状态

**示例**：
```
| 指标 | 评分 | 状态 |
|------|------|------|
| 利率结构 | +1 | 顺风 |
| 流动性 | -1 | 逆风 |
| 盈利周期 | 0 | 中性 |

综合评分: 0 ➡️ neutral
MacroRiskFactor: 0.90
```

**解读要点**：

1. **利率结构顺风**
   - 利差正常、实际利率低、信用利差窄
   - 有利于慢变量释放能量

2. **流动性逆风**
   - M2收缩、信贷增长放缓
   - 资金地形变冷

3. **综合中性偏逆风**
   - 系统降低仓位上限10%
   - 不是"清仓信号"，只是"谨慎信号"

4. **行动建议**：
   - 不因宏观逆风而恐慌性卖出
   - 保持现有持仓
   - 新增仓位更加谨慎

### 5.5 轮动信号

**示例**：
```
| 主题 | 平均加速度 | Z-Score | 权重调整 |
|------|-----------|---------|---------|
| AI/算力密度 | 68.5 | +1.25 | +10% |
| 老龄化/医疗支付 | 52.0 | +0.15 | 不变 |
| 金融制度/支付清算 | 48.0 | -0.35 | 不变 |
| 品牌/代际消费 | 42.0 | -0.85 | -5% |
```

**解读要点**：

1. **AI主题 Z=+1.25**
   - 加速度最强
   - 建议增加10%权重
   - 但需注意主题上限（30%）

2. **品牌消费 Z=-0.85**
   - 加速度较弱
   - 建议减少5%权重
   - 可能进入稳态期或衰减期

3. **行动建议**：
   - 季度调仓时参考轮动信号
   - 不要频繁轮动（每季度最多一次）
   - 轮动幅度不超过建议值

### 5.6 违规警告

**示例**：
```
⚠️ 违规警告:
- ⚠️ 主题 [AI/算力密度] 暴露 32.0% 超过上限 30.0%
- ⚠️ NVDA 权重 8.5% 超过单票上限 8.0%
```

**解读要点**：

1. **主题超限**
   - 需要减仓AI主题标的
   - 或等待其他主题标的加入稀释

2. **单票超限**
   - 需要减仓NVDA
   - 或增加其他标的稀释

3. **行动建议**：
   - 立即调整，不要拖延
   - 违规会增加组合脆弱性


---

## 第六部分：调仓决策

### 6.1 建仓规则

**触发条件**（必须全部满足）：
- SVI ≥ 75
- 估值 Tier ≠ C
- 相位 ≠ 衰减期

**建仓方式**：
1. 首次建仓：目标仓位的 **50%**
2. 剩余 50% 等待：
   - 相位进入加速期，或
   - 估值下修到 Tier A

**示例**：
```
目标权重 8% → 首次建仓 4%
等待加速期或估值改善 → 补足到 8%
```

**原因**：避免"一次性满仓"，留有加仓空间。

### 6.2 加仓规则

**触发条件**：
- 相位从稳态期 → 加速期
- 估值从 Tier B → Tier A
- 当前权重 < 目标权重

**加仓节奏**：
- 每月最多 +1%
- 单季度最多 +3%

**示例**：
```
当前 4% → 目标 8%
第1个月：4% → 5%
第2个月：5% → 6%
第3个月：6% → 7%
第4个月：7% → 8%
```

**原因**：避免追高，分批建仓。

### 6.3 减仓规则

#### 轻度减仓（-30%）

**触发条件**（任一）：
- 相位从加速期/稳态期 → 衰减期
- 估值从 Tier A → Tier B → Tier C 下降一级

**行动**：
- 减仓 30%
- 观察两季度
- 若未改善 → 重度减仓

**示例**：
```
当前 8% → 减至 5.6%
观察 6 个月
若相位恢复 → 保持 5.6%
若继续衰减 → 重度减仓
```

#### 重度减仓（-50%）

**触发条件**（任一）：
- ROIC 连续2年下降
- 毛利结构恶化
- 慢变量代理指标确认拐点
- 轻度减仓后两季度未改善

**行动**：
- 减仓 50%
- 观察两季度
- 若未改善 → 清仓

**示例**：
```
当前 8% → 减至 4%
观察 6 个月
若结构恢复 → 保持 4%
若结构破坏 → 清仓
```

### 6.4 清仓规则

**触发条件**（任一，立即执行）：
- 行业结构被技术颠覆
- 牌照/制度壁垒失效
- 会计质量恶化（财务造假）
- SVI < 65（跌出核心池和观察池）
- 慢变量方向逆转

**行动**：
- 立即清仓
- 不等待反弹
- 不抱侥幸心理

**示例**：
```
教育行业政策突变 → 立即清仓教育股
数码相机被智能手机替代 → 立即清仓胶卷公司
```

**原因**：这是"结构破坏"，不是"价格波动"。

### 6.5 持有规则

**触发条件**：
- SVI ≥ 75
- 估值 Tier = A 或 B
- 相位 = 加速期或稳态期
- 当前权重 ≈ 目标权重（偏差 < 0.5%）

**行动**：
- 不动
- 不因价格涨跌调仓
- 不因短期新闻调仓

**原因**：慢变量系统不对价格噪音反应。

### 6.6 调仓频率

**季度检查**（结构稳定性）：
- 检查 ROIC 趋势
- 检查 FCF 质量
- 检查毛利稳定性
- **不因股价涨跌调仓**

**半年检查**（估值安全垫）：
- 更新 FCF Yield
- 更新 QPEG
- 更新估值分位
- 若 Tier 降级 → 减仓

**年度检查**（慢变量方向）：
- 慢变量方向是否改变？
- 行业结构是否破坏？
- 是否出现替代技术？
- **这是最重要的检查**

### 6.7 再平衡机制

**触发条件**：
- 实际权重偏离目标权重 > ±1%

**行动**：
- 每半年做一次再平衡
- 将实际权重拉回目标权重

**示例**：
```
目标 8%，实际 9.5% → 卖出 1.5%
目标 8%，实际 6.2% → 买入 1.8%
```

**原因**：避免单一标的权重漂移。


---

## 第七部分：常见问题

### 7.1 关于 SVI 评分

**Q1：为什么我的高成长股 SVI 很低？**

A：SVIP 不是成长股系统。高成长股往往：
- ROIC 不稳定（未通过硬筛选）
- FCF 转化率低（烧钱）
- 毛利率波动大
- 慢变量绑定度低（快变量驱动）

SVIP 只选择"慢变量对齐的结构稳定企业"。

**Q2：SVI 评分会随时间变化吗？**

A：会，但变化很慢。SVI 基于10年财务数据，短期波动不会影响评分。只有当：
- 10年ROIC趋势改变
- FCF质量持续恶化
- 行业结构破坏

SVI 才会显著下降。

**Q3：SVI 75 和 85 有本质区别吗？**

A：有。
- SVI 75-80：刚过及格线，需要密切观察
- SVI 80-90：高质量，可以长期持有
- SVI 90+：极高质量，可以作为核心底仓

### 7.2 关于估值

**Q4：为什么好公司也会被评为 Tier C？**

A：好公司 ≠ 好价格。Tier C 不是说公司不好，而是说：
- FCF Yield < 3%（现金回报太低）
- QPEG > 1.8（增长不足以支撑估值）
- 红旗触发（估值拥挤、增长预期过高等）

**行动**：等待价格回调，不要追高。

**Q5：QPEG 和传统 PEG 有什么区别？**

A：QPEG 考虑了质量因子。

示例：
```
公司A：PE=30, g=15%, SVI=80
  传统PEG = 30/15 = 2.0（偏贵）
  QPEG = 2.0 / (1+0.8) = 1.11（合理）

公司B：PE=30, g=15%, SVI=60
  传统PEG = 30/15 = 2.0（偏贵）
  QPEG = 2.0 / (1+0.6) = 1.25（仍偏贵）
```

高质量企业可以"更贵一点"。

**Q6：估值 Tier 多久更新一次？**

A：建议每半年更新一次（1月、7月）。不要因为短期价格波动频繁更新。

### 7.3 关于相位

**Q7：如何判断慢变量是否在加速？**

A：看代理指标的"二阶导"（加速度），不是一阶导（增长率）。

示例：
```
AI算力 GPU出货量：
  Q1: 100 → Q2: 110 → Q3: 125
  一阶导：+10% → +13.6%（增长率在加速）
  二阶导：正（加速期）

  Q1: 100 → Q2: 110 → Q3: 118
  一阶导：+10% → +7.3%（增长率在减速）
  二阶导：负（衰减期）
```

**Q8：相位衰减就一定要卖吗？**

A：不一定。分两种情况：
1. **短期衰减**：可能是季节性波动，观察两季度
2. **趋势性衰减**：慢变量方向改变，需要减仓

先减仓50%，观察两季度，若未改善再清仓。

**Q9：没有代理指标数据怎么办？**

A：可以使用默认值（稳态期）。系统会给 AccelerationScore = 50，相位因子 = 1.0。

### 7.4 关于组合

**Q10：为什么现金比例这么高（30%）？**

A：可能原因：
1. ValuationTier=A 的标的数量 < 6（机会太少）
2. 全市场普遍估值脆弱（Tier C 占比 > 60%）
3. 宏观强逆风 + 尾部风险紧张

**行动**：耐心等待。现金是"等待慢变量给窗口"，不是"踏空"。

**Q11：为什么系统建议减仓我的持仓股？**

A：可能原因：
1. 相位从加速期→稳态期→衰减期
2. 估值从 A→B→C 降级
3. ROIC 连续下降
4. 慢变量方向改变

**行动**：先减50%，观察两季度，若未改善则清仓。不要抱侥幸心理。

**Q12：可以修改配置参数吗？**

A：不建议。`config/settings.py` 中的所有阈值、权重都是基于理论体系设计的。随意修改会破坏系统逻辑。

如果一定要调整：
1. 先运行3-6个月，观察系统行为
2. 记录每次想修改的冲动
3. 季度末统一评估是否真的需要调整

**慢变量系统的核心是"不因短期波动改变规则"**。

### 7.5 关于宏观

**Q13：宏观逆风就要清仓吗？**

A：不。宏观逆风只是降低仓位上限，不是清仓信号。

示例：
```
原仓位上限 80% → 宏观逆风 → 降至 60%
不是"卖到 60%"，而是"不超过 60%"
```

**行动**：保持现有持仓，新增仓位更加谨慎。

**Q14：宏观数据从哪里获取？**

A：
- 美股：FRED（https://fred.stlouisfed.org/）
- A股：Wind、同花顺、东方财富
- 手动填写到 `data/macro_inputs.yaml`

未来版本会支持 API 自动获取。

### 7.6 关于系统使用

**Q15：SVIP 和 SPUD-INVEST 有什么区别？**

A：
- **SPUD-INVEST**：仓位边界系统，决定"买多少"
- **SVIP**：股票选择系统，决定"买什么"

两者互补：
1. SVIP 筛选出核心池（10-20只）
2. SPUD-INVEST 根据 SMI/MTI 确定总仓位上限
3. SVIP 在仓位上限内分配权重

**Q16：多久运行一次系统？**

A：
- 年度（1次）：更新慢变量清单、结构筛选
- 半年（2次）：估值过滤
- 季度（4次）：相位判断、生成报告
- 月度（12次）：宏观观察

**不要每天运行，不要因为价格波动频繁运行。**

**Q17：系统能保证收益吗？**

A：不能。SVIP 不预测收益，只做结构对齐。

系统目标：
- 降低结构性毁灭概率
- 提高长期存续概率
- 控制回撤幅度

长期回报来自：存续 + 节律控制 + 相位正确跃迁。


---

## 第八部分：进阶使用

### 8.1 自定义慢变量主题

**场景**：你发现了新的慢变量，想添加到系统中。

**步骤**：

1. 编辑 `data/slow_variables.yaml`：
```yaml
slow_variables:
  - name: "你的慢变量"
    time_horizon: "20年"
    certainty: "高"
    theme: "你的主题"
    proxy_indicators:
      - "代理指标1"
      - "代理指标2"
```

2. 编辑 `data/theme_buckets.yaml`：
```yaml
theme_buckets:
  "你的主题":
    description: "主题描述"
    value_capture_nodes:
      - "价值捕获节点1"
      - "价值捕获节点2"
    typical_stocks:
      - {symbol: "XXX", name: "公司名"}
```

3. 在股票数据中指定主题：
```yaml
stocks:
  - symbol: "XXX"
    theme: "你的主题"
```

### 8.2 跨市场运行

**美股**（默认）：
```bash
python run_svip.py --market US
```

**港股**（更严格的阈值）：
```bash
python run_svip.py --market HK
```
- SVI 阈值提高到 80
- 单票上限降至 6%
- 主题桶上限降至 25%

**A股**（相位权重 > 估值权重）：
```bash
python run_svip.py --market CN
```
- SVI 阈值提高到 80
- 单票上限降至 5%
- 主题桶上限降至 20%

### 8.3 批量处理多只股票

**场景**：你有100只候选股票，想批量计算 SVI。

**方法1：准备 YAML 文件**

创建 `data/my_100_stocks.yaml`，包含所有股票的财务数据。

```bash
python run_svip.py --stocks data/my_100_stocks.yaml
```

**方法2：编写 Python 脚本**

```python
import sys
sys.path.insert(0, '.')

from src.svi_engine import compute_svi
import pandas as pd

# 读取你的数据
df = pd.read_csv('my_stocks.csv')

results = []
for _, row in df.iterrows():
    svi = compute_svi(
        symbol=row['symbol'],
        market='US',
        roic_10y_median=row['roic'],
        fcf_conversion=row['fcf_ratio'],
        gross_margin_std=row['margin_std'],
        debt_to_equity=row['debt_ratio'],
    )
    results.append({
        'symbol': row['symbol'],
        'svi': svi.total,
        'level': svi.level.value,
    })

result_df = pd.DataFrame(results)
result_df.to_csv('svi_results.csv', index=False)
```

### 8.4 集成数据库

**场景**：从 `../database/china_a_stocks.db` 读取财务数据。

**示例脚本**：

```python
import sqlite3
import sys
sys.path.insert(0, '.')

from src.svi_engine import compute_svi

# 连接数据库
conn = sqlite3.connect('../database/china_a_stocks.db')

# 查询财务数据
query = """
SELECT 
    ts_code as symbol,
    AVG(roe) as roic,
    AVG(fcf_ratio) as fcf_conversion,
    STDEV(gross_margin) as margin_std
FROM financial_data
WHERE year >= 2014
GROUP BY ts_code
HAVING COUNT(*) >= 10
"""

df = pd.read_sql(query, conn)

# 批量计算 SVI
for _, row in df.iterrows():
    svi = compute_svi(
        symbol=row['symbol'],
        market='CN',
        roic_10y_median=row['roic'] / 100,
        fcf_conversion=row['fcf_conversion'],
        gross_margin_std=row['margin_std'] / 100,
        debt_to_equity=1.0,  # 需要单独查询
    )
    if svi.level.value == 'core':
        print(f"{row['symbol']}: SVI={svi.total:.1f}")

conn.close()
```

### 8.5 自动化报告邮件

**场景**：每季度自动生成报告并发送邮件。

**步骤**：

1. 安装邮件库：
```bash
pip install yagmail
```

2. 创建 `send_report.py`：
```python
import yagmail
import os
from datetime import datetime

# 运行 SVIP
os.system('python run_svip.py')

# 找到最新报告
reports_dir = 'reports'
files = os.listdir(reports_dir)
latest = max(files, key=lambda f: os.path.getctime(os.path.join(reports_dir, f)))
report_path = os.path.join(reports_dir, latest)

# 发送邮件
yag = yagmail.SMTP('your_email@gmail.com', 'your_password')
yag.send(
    to='recipient@example.com',
    subject=f'SVIP 季度报告 - {datetime.now().strftime("%Y-%m-%d")}',
    contents='请查收附件中的 SVIP 报告。',
    attachments=report_path,
)
print(f"报告已发送: {latest}")
```

3. 设置定时任务（Linux/Mac）：
```bash
# 编辑 crontab
crontab -e

# 每季度末运行（3月31日、6月30日、9月30日、12月31日）
0 9 31 3,6,9,12 * cd /path/to/svip && python send_report.py
```

### 8.6 与 SPUD-INVEST 联动

**场景**：同时使用 SVIP 和 SPUD-INVEST。

**工作流程**：

1. **SVIP 选股**：
```bash
cd project/svip
python run_svip.py
# 输出：核心池 10-20 只股票
```

2. **SPUD-INVEST 定仓位**：
```bash
cd project/spud-invest
python run_spud_invest.py
# 输出：总仓位上限（如 70%）
```

3. **手动整合**：
   - SVIP 核心池权重总和 = SPUD 仓位上限
   - 按 SVIP 目标权重比例分配

**示例**：
```
SVIP 输出：
  MSFT 8%, V 7.5%, UNH 6.2%, SPGI 5.8%
  总和 = 27.5%

SPUD 输出：
  总仓位上限 = 70%

最终配置：
  MSFT: 8% × (70/27.5) = 20.4%
  V: 7.5% × (70/27.5) = 19.1%
  UNH: 6.2% × (70/27.5) = 15.8%
  SPGI: 5.8% × (70/27.5) = 14.8%
  总和 = 70%
```

### 8.7 回测验证

**场景**：验证 SVIP 系统的历史表现。

**注意事项**：
1. 必须使用历史数据（避免未来函数）
2. 财报发布滞后1个季度
3. 包含交易成本（0.3%-0.5%）
4. 考虑生存偏差（退市股票也要纳入）

**简化回测脚本**：

```python
import pandas as pd
from datetime import datetime, timedelta

# 历史数据
dates = pd.date_range('2014-01-01', '2024-01-01', freq='Q')
portfolio_history = []

for date in dates:
    # 1. 获取该季度的财务数据（滞后1季度）
    data_date = date - timedelta(days=90)
    
    # 2. 运行 SVIP（使用历史数据）
    # ... 省略具体实现
    
    # 3. 记录组合
    portfolio_history.append({
        'date': date,
        'stocks': [...],  # 持仓列表
        'weights': [...],  # 权重
    })

# 4. 计算收益
# ... 省略具体实现

# 5. 输出结果
print(f"年化收益: {annual_return:.2%}")
print(f"最大回撤: {max_drawdown:.2%}")
print(f"夏普比率: {sharpe:.2f}")
```

---

## 附录

### A. 命令行参数完整列表

```bash
python run_svip.py [选项]

选项:
  -s, --stocks PATH      股票数据 YAML 路径（默认: data/sample_stocks.yaml）
  -m, --macro PATH       宏观数据 YAML 路径（默认: data/macro_inputs.yaml）
  --market {US,HK,CN}    目标市场（默认: US）
  --no-save              不保存 Markdown 报告
  -h, --help             显示帮助信息
```

### B. 数据文件格式参考

详见 `data/sample_stocks.yaml` 和 `data/macro_inputs.yaml`。

### C. 配置参数说明

详见 `config/settings.py`，包含所有阈值、权重、约束的详细说明。

### D. 理论基础文档

完整理论见：`理论区/理论体系综述与知识脉络_v5.8_20260228.md`
- 第六十八章：慢变量理论体系与识别方法
- 第六十九章：慢变量存在论投资学——从SVIP框架到文明资本论

### E. 联系与支持

- 项目地址：`project/svip/`
- 文档：`README.md`, `USAGE.md`, `PROJECT_SUMMARY.md`
- 问题反馈：记录在 `issues.md`（自行创建）

---

## 结语

> **投资不是预测未来，而是在慢变量构成的存在地形中，寻找稳定结构并与之共振。**  
> **这不是技巧，这是世界观。**

SVIP 系统帮你：
- 识别地形（慢变量）
- 筛选结构（高质量企业）
- 控制风险（估值安全垫 + 约束）
- 把握相位（加速/稳态/衰减）

但最终的投资决策，仍然由你做出。

系统是工具，不是替代品。

**祝你投资顺利！**

---

*SVIP v1.0 操作手册 — 2026年2月28日*
